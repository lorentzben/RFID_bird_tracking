---
title: "Look into markov chains"
output:
  pdf_document: default
  html_notebook: default
---


```{r}
rand <- sample(1:3, 100, replace=TRUE)
hist(rand)

norm <- as.integer(rnorm(100,mean=2, sd=1))

unif <- as.integer(runif(100, min=1, max=4))
```

```{r}
library(markovchain)

mcWeather <- new("markovchain", states=c("sunny","cloudy","rain"), transitionMatrix = matrix(data=c(0.70,0.2,0.1, 0.3,0.4,0.3,0.2,0.45,0.35),byrow=T, nrow=3),name="Weather")

weatherOfDays <- rmarkovchain(n=365, object=mcWeather, t0="sunny")


tmp <- markovchainFit(data=weatherOfDays, method="mle", name = "Weather MLE")

plot(mcWeather)
plot(tmp$estimate)

mcWeather
tmp$estimate

test <- markovchainFit(data=rand, method="mle", name="Bird jumping")
plot(test$estimate)

test2 <- markovchainFit(data=norm, method="mle", name="normal birds")
plot(test2$estimate)

test3 <- markovchainFit(data=unif, method="mle", name="uniform birds")
plot(test3$estimate)

```

```{r, overall 6928 markov chain}
six_nine_two_eight <- read.csv("6928.csv")

six_nine_two_eight["DateTime"] <- as.POSIXct(six_nine_two_eight$access, origin="1970-01-01", tz="GMT")

six_nine_two_eight_uniq <-subset(six_nine_two_eight, subzone!="test")

unique(six_nine_two_eight_uniq$subzone)

test <- markovchainFit(data=six_nine_two_eight_uniq$subzone, method="mle", name="Tag number 6928 overal")
test
plot(test$estimate)

```

```{r, function to calc transitions}
#input a sample name
#returns a vector labeled with sample name, and bottom, middle, top and total transitions

calc_trans<- function(samp_name,samp_obj){
  bottom_trans <-0
  mid_trans<-0
  top_trans<-0
  trans<-0
  count <- 0
  
  for (i in 2:length(samp_obj$subzone)) {
  previous_state <- samp_obj$subzone[i-1]
  current_state <- samp_obj$subzone[i]
  
  #print(paste(previous_state,":",current_state))
  
  
  if (previous_state == current_state) {
    count <- count+1
    
  }
  else{
    
    if(current_state == "bottom" || current_state == "Bottom"){
      bottom_trans <- bottom_trans+1
      trans<- trans+1
    }
    if (current_state=="middle" || current_state == "Middle") {
      mid_trans <- mid_trans+1
      trans <- trans+1
    }
    if(current_state =="top" || current_state=="Top"){
      top_trans <- top_trans+1
      trans <- trans+1
    }
  }
  }
  result <- c(samp_name,bottom_trans,mid_trans,top_trans,trans)
  return(result)
  
}
```


```{r}
six_eight_nine_four <- read.csv("6894.csv")

six_eight_nine_four["DateTime"] <- as.POSIXct(six_eight_nine_four$access, origin="1970-01-01", tz="GMT")

unique(six_eight_nine_four$subzone)

six_eight_nine_four$subzone[six_eight_nine_four$subzone == "M"] <- "middle"
six_eight_nine_four$subzone[six_eight_nine_four$subzone == "B"] <- "bottom"
six_eight_nine_four$subzone[six_eight_nine_four$subzone == "T"] <- "top"

plot(subset(six_eight_nine_four, DateTime >= as.POSIXct("2021-02-17 00:00",tz="GMT")& DateTime<= as.POSIXct("2021-02-18 00:00",tz="GMT"))$DateTime, as.factor(subset(six_eight_nine_four, DateTime >= as.POSIXct("2021-02-17 00:00",tz="GMT")& DateTime<= as.POSIXct("2021-02-18 00:00",tz="GMT"))$subzone))

six_eight_nine_four_overall_transitions <- calc_trans("six_eight_nine_four_total",six_eight_nine_four)

bottom_trans/trans
mid_trans/trans
top_trans/trans


```


```{r, setup zoo for six eight nine four}
library(xts)

six_eight_nine_four <- read.csv("6894.csv")

six_eight_nine_four["DateTime"] <- as.POSIXct(six_eight_nine_four$access, origin="1970-01-01", tz="GMT")

unique(six_eight_nine_four$subzone)

six_eight_nine_four$subzone[six_eight_nine_four$subzone == "M"] <- "middle"
six_eight_nine_four$subzone[six_eight_nine_four$subzone == "B"] <- "bottom"
six_eight_nine_four$subzone[six_eight_nine_four$subzone == "T"] <- "top"

unique(six_eight_nine_four$subzone)

sum(is.na(six_eight_nine_four$DateTime))

six_eight_nine_four <- six_eight_nine_four[!is.na(six_eight_nine_four$DateTime),]

sum(is.na(six_eight_nine_four$DateTime))

xts_6894 <- xts(six_eight_nine_four,order.by = six_eight_nine_four$DateTime)

summary(xts_6894)

daily_6894 <- to.daily(xts_6894$subzone, OHLC=F,)
weekly_6894 <- to.weekly(xts_6894, OHLC=F)
monthly_6894 <- to.monthly(xts_6894, OHLC=F)

length(daily_6894)

daily_6894$DateTime[]

day1_6894 <- xts_6894[paste0("2020-11-16 20:39:26","/",daily_6894$DateTime[1])]

```

